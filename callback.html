<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discord 認証結果</title>
    <script>
        // URLのクエリパラメータから認証コードを取得
        function getQueryParam(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        window.onload = async function() {
            const code = getQueryParam('code');
            if (code) {
                document.getElementById('auth-code').innerText = '認証コード: ' + code;

                // サーバーに認証コードを送信し、ユーザー情報を取得
                try {
                    const response = await fetch(`https://vibeshiftteam.github.io/disccordboard/callback.html?code=${code}`);
                    
                    // 応答が正常かどうかをチェック
                    if (!response.ok) {
                        throw new Error('ユーザー情報の取得に失敗しました');
                    }

                    const userData = await response.json();
                    
                    // ユーザー情報を表示
                    document.getElementById('username').innerText = `ユーザー名: ${userData.username}#${userData.discriminator}`;
                    document.getElementById('email').innerText = `メールアドレス: ${userData.email || '未設定'}`;
                    
                    // アバターのURLを作成して表示
                    const avatarUrl = `https://cdn.discordapp.com/avatars/${userData.id}/${userData.avatar}.png`;
                    document.getElementById('avatar').src = avatarUrl;
                    
                    // バナーが設定されていれば、バナー画像を表示
                    if (userData.banner) {
                        const bannerUrl = `https://cdn.discordapp.com/banners/${userData.id}/${userData.banner}.png?size=2048`;
                        document.getElementById('banner').style.backgroundImage = `url(${bannerUrl})`;
                    } else {
                        document.getElementById('banner').innerText = "バナーは設定されていません";
                    }

                    // バナーカラーを設定（もし存在すれば）
                    if (userData.banner_color) {
                        document.getElementById('banner').style.backgroundColor = `#${userData.banner_color}`;
                    }
                } catch (error) {
                    console.error(error);
                    document.getElementById('error').innerText = 'ユーザー情報の取得に失敗しました。';
                }
            } else {
                document.getElementById('auth-code').innerText = '認証コードがありません。';
            }
        };
    </script>
</head>
<body>
    <h1>Discord 認証結果</h1>
    <p id="auth-code">認証コードを取得中...</p>
    
    <div id="user-info">
        <p id="username"></p>
        <p id="email"></p> <!-- メールアドレス表示 -->
        <img id="avatar" alt="ユーザーアバター" width="100" />
    </div>
    
    <div id="banner" style="width: 100%; height: 200px; background-color: #ccc; background-size: cover;">
        <!-- バナーが設定されている場合は画像として表示され、ない場合はメッセージが表示されます -->
    </div>

    <p id="error" style="color: red;"></p>
</body>
</html>
